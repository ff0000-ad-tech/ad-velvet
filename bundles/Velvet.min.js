!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("window")):"function"==typeof define&&define.amd?define(["window"],t):"object"==typeof exports?exports.Velvet=t(require("window")):e.Velvet=t(e.window)}("undefined"!=typeof self?self:this,function(e){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(){var e={},t=window.location.href.split("?");if(t.length>1){var n=t[1].split("&");for(var r in n){var o=n[r].split("=");2==o.length&&(e[o[0]]=decodeURIComponent(o[1]))}}return e}function c(e){var t=e.search(/^\/\//)>-1;if(e.search(/^http/)>-1||t){var n=window.location.href.search(/^https/)>-1||window.adParams&&adParams.forceHttps,r=n?"https://":"http://";if(t&&(e=e.replace(/^\/\//,r)),e.search(/.*edgecastcdn/)>-1){e=r+(n?"ne1."+e.match(/w(a|p)c/i)[0]+".":e.match(/w(a|p)c\.[a-z0-9]*\./i)[0])+"edgecastcdn"+e.replace(/.*edgecastcdn/,"")}else if(e.search(/.*paramount\.com/)>-1){var o=n?"paramountdlds-a.akamaihd.net":"downloads.paramount.com";e=r+o+e.replace(/.*paramount\.com/,"")}else e=e.search(/espn\.go\.com/)>-1||e.search(/secure\.espncdn\.com/)>-1?"https://secure.espncdn.com"+e.replace(/^.*\.com/,""):e.replace(/^https?\:\/\//i,r)}return e}function s(){try{return new XMLHttpRequest}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}return null}function u(e){var t=e.lastIndexOf("."),n=e.lastIndexOf("/")+1;return n>t&&(t=void 0),e.substring(n,t)}function l(e){e=e||"";var t=e.indexOf("?");t>-1&&(e=e.substr(0,t));var n=e.match(/[^\\]*\.(\w+)$/),r=e.match(/image\/(jpeg|jpg|png)/);return n?n[1]:r?r[1]:"unknown"}function f(e){if("string"==typeof e)return e;var t="";for(var n in e)t+=n+"="+e[n]+"&";return t.substr(0,t.length-1)}function p(e){var t=[],n=[0];for(var r in e)t.push(r),n.push(e[r]+(n[n.length-1]||0));for(var o=100*Math.random().toFixed(2),a=0;a<n.length-1;a++){if(d(o,n[a],n[a+1]))return t[a]}}function d(e,t,n){var r=Math.min(t,n);return e<=Math.max(t,n)&&e>=r}function h(e,t){ee[e]||(ee[e]=[]);for(var n=ee[e],r=0,o=n.length;r<o;r++)if(n[r]===t)return;n.push(t)}function v(e,t){var n=ee[e];if(n)for(var r=0,o=n.length;r<o;r++)if(n[r]===t){n.splice(r,1);break}}function m(e){ee[e]&&ee[e].map(function(e){e()})}function y(e,t,n,r){L.DateManager.init(t),ae=n,se=r;var o=document.referrer.match(/staging\.velvet\.tech/);te=g()?o?K:V:o?$:J,ne=e,te+=ne.client+"/"+ne.locale+"/";var a=i(),c=a.addata;return c&&(ne.addata=c),ce="1"===a.velvetCaptureRotate,ie="1"===a.velvetCaptureSlates,new Promise(function(e,t){re=e,ne.addata?b():w()})}function g(){var e=window.location.href;if(void 0==e||null==e)return!1;var t=i();return"production"!==t.velvet&&("preview"===t.velvet||!!(e.match(/^file/)||e.match(/velvet\.ff0000\-cdn\.net/)||e.match(/velvet\-staging\.ff0000\-cdn\.net/)||e.match(/velvet\-dev\.ff0000\-cdn\.net/)||e.match(/manta\.joyent\.com/)||e.match(/ff0000\.com/)||e.match(/adprodtest/)||e.match(/client\-projects\.com/)||e.match(/[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+:[0-9]+/)))}function w(){new X(te+ne.segment,{name:"segmentLoader",fileType:"json",onComplete:T,onFail:j}).load()}function b(){new X(te+ne.addata,{name:"velvetAdDataLoader",fileType:"json",onComplete:x,onFail:j}).load()}function T(e){var t=JSON.parse(e.dataRaw);L.DateManager.setDefaultTimezone(t.tz);var n=t.timeblocks,r=L.DateManager.getNow(),o=void 0;for(o=0;o<n.length;o++){if(r<n[o].time)break}var a=o-1;if(a<0)return void j();var i=n[a].ad_rotation;if(ne.addata=p(i),"USE_STATIC"===ne.addata)return void m(Y);b()}function x(e){oe=JSON.parse(e.dataRaw),re(),m(Q)}function j(){m(W)}function q(e){for(var t=e.getDates(!0),n=0;n<t.length;n++){var r=t[n],o=r.date,a={date:o.toISO(),tz:o.outputTimezone.abbr[0],ltz:adParams.defaultTimezone,label:r.standardKey};ue.push(a)}}function C(e){if("object"!==(void 0===e?"undefined":N(e)))throw new Error("Cannot use a primative as data, must be an Object passed to .addCustomData()");ue.push(e)}function O(){0===ue.length&&ue.push({foo:"bar"}),_("setParameters",ue)}function S(){var e=Date.now(),t=e-le;_("adComplete",{duration:t}),ie&&(fe.style.background="#ff0000",fe.style.display="block")}function P(){return new Promise(function(e,t){M(se),le=Date.now(),_("adStart"),ie?(fe=k(),M(fe),setTimeout(function(){fe.style.display="none",e()},100)):e()})}function _(e,t){t=t||{},"function"==typeof window.callExternal&&window.callExternal({event:e,data:t})}function M(e){if(ce){var t=ae.split("x")[0];e.style.transform="matrix(0, -1, 1, 0, 0, "+t+")",e.style.transformOrigin="0 0"}}function k(){var e=ae.split("x"),t=e[0],n=e[1],r=document.createElement("div");return r.id="slate",r.style.cssText="position: absolute; width: "+t+"px; height: "+n+"px; background: #00ff00;",se.parentNode.appendChild(r),r}function z(){if(0==arguments.length)return oe;var e="string"==typeof arguments[0],t=arguments[e?0:1],n=e?oe:arguments[0];de=!!arguments[e?1:2],he=[];var r=t.replace(/\.value(\.|)/g,".").replace(/\.$/,"");return ye=r.split("."),me=void 0,ve=ye.pop(),ge=ye.length>0,ge&&(me=ye.shift(),ye.push(ve)),D(n),1==he.length?(he=he[0])&&"object"==(void 0===he?"undefined":N(he))&&0==Object.keys(he).length&&(he=void 0):0==he.length&&(he=void 0),he}function D(e){switch(Object.prototype.toString.call(e)){case"[object Object]":I(e);break;case"[object Array]":A(e)}}function I(e){for(var t in e)E(e,t)}function A(e){if(ge||isNaN(ve))for(var t=0;t<e.length;t++)I(e[t]);else he.push(e[ve])}function E(e,t){if(t!=ve||ge){if(t==me){var n=R(ye,e[t]);return void(n&&he.push(F(n)))}}else he.push(F(e[t]));de&&D(e[t])}function F(e){if(e.hasOwnProperty("type")){var t="MultiSizeText"==e.type,n="MultiSizeImage"==e.type;if(t||n){if(e.value.sizes.hasOwnProperty(ae)){var r=e.value.sizes[ae];if(t&&""!=r||n&&r)return r}e=e.value}}return e.hasOwnProperty("value")?e.value:e}function R(e,t){for(var n,r=t||{},o=0;r&&(n=e[o]);o++){var a=F(r);r=n in a?a[n]:void 0}return r}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"init",function(){return be}),n.d(t,"isPreviewLocation",function(){return Te}),n.d(t,"addEventListener",function(){return xe}),n.d(t,"removeEventListener",function(){return je}),n.d(t,"events",function(){return qe}),n.d(t,"capture",function(){return Ce}),n.d(t,"get",function(){return Oe}),n.d(t,"convertBreaks",function(){return Se});var L=n(1),N=(n.n(L),"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}),U=function(){function e(t){a(this,e),this.superclass=t}return e.prototype.with=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return t(e)},this.superclass)},e}(),B=function(e){return function(e){function t(){for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];a(this,t);var c=r(this,e.call.apply(e,[this].concat(o))),s=arguments&&arguments.length>1?arguments[1]:arguments[0]||{},u=c;return u.onComplete=s.onComplete||function(){},u.onFail=s.onFail||function(){},u.onProgress=s.onProgress||function(){},u.name=s.name||"",u.scope=s.scope||u,u.dataRaw,u.cacheBuster=s.cacheBuster||!1,u._failCalled=!1,c}return o(t,e),t.prototype._handleFail=function(){var e=this;e._failCalled||(e._failCalled=!0,e.onFail.call(e.scope,e))},t}(e)},G=function(e){return function(e){function t(){for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];a(this,t);var s=r(this,e.call.apply(e,[this].concat(o))),f=arguments&&arguments.length>1?arguments[1]:arguments[0]||{},p=s;return p.url=c(arguments[0]||""),f.platformGetUrl&&(p.platformGetUrl=f.platformGetUrl,p.url=f.platformGetUrl(p.url)),p.fileName=void 0===f.id?u(p.url):f.id,p.fileType=f.fileType||l(p.url),s}return o(t,e),t}(e)},H=function e(){a(this,e)},X=function(e){function t(){for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];a(this,t);var c=r(this,e.call.apply(e,[this].concat(o))),s=arguments&&arguments.length>1?arguments[1]:arguments[0]||{},u=c;return u.method=(s.method||"get").toLowerCase(),u.query=s.query||null,u.responseType=s.responseType||null,c}return o(t,e),t.prototype.load=function(){var e=this,t=null,n="post"===e.method;e.req=s(),void 0!=e.responseType&&(e.req.responseType=e.responseType);var r=e.url;switch(e.query&&(t=f(e.query),n||(r+="?"+t,t=null)),e.cacheBuster&&(r+=e.query&&!n?"&":"?",r+="cb="+(new Date).getTime()),e.req.onreadystatechange=e._handleStateChange.bind(e),e.req.open(e.method,r,!0),e.fileType){case"xml":e.req.overrideMimeType&&e.req.overrideMimeType("text/xml");break;case"json":e.req.overrideMimeType&&e.req.overrideMimeType("application/json");break;case"fba":case"bin":case"binary":e.responseType=e.req.responseType="arraybuffer"}"post"===e.method&&e.req.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.req.send(t)},t.prototype._handleStateChange=function(e){var t=this;switch(t.req.readyState){case 3:200==this.req.status&&(t.dataRaw=t.responseType?t.req.response:t.req.responseText,t._handleProgress(t));break;case 4:200==t.req.status?(t.dataRaw=t.responseType?t.req.response:t.req.responseText,t._handleComplete(t)):t._handleFail({target:e})}},t.prototype._handleProgress=function(){var e=this;e.onProgress.call(e.scope,e)},t.prototype._handleComplete=function(){var e=this;e.onComplete.call(e.scope,e)},t}(function(e){return new U(e)}(H).with(B,G)),J="https://json.ff0000-cdn.net/",V="https://preview.ff0000-cdn.net/preview/",$="https://publish-staging.ff0000-cdn.net/",K="https://staging.velvet.tech/preview/",Q="velvetInit",W="velvetFail",Y="velvetStatic",Z=Object.freeze({INIT:Q,FAIL:W,STATIC:Y}),ee={},te=void 0,ne=void 0,re=void 0,oe={},ae=void 0,ie=!1,ce=!1,se=void 0,ue=[],le=void 0,fe=void 0,pe=Object.freeze({addSchedule:q,addCustomData:C,dispatchData:O,adComplete:S,adStart:P}),de=void 0,he=[],ve=void 0,me=void 0,ye=void 0,ge=void 0,we=function(e){return e.replace(/\r?\n|\r/g,"<br>")},be=y,Te=g,xe=h,je=v,qe=Z,Ce=pe,Oe=z,Se=we},function(t,n){t.exports=e}])});